<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Onboarding - SQL Script Generator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/modern.css">
</head>
<body>
    <!-- Header -->
    <header class="app-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col">
                    <h1 class="header-title">
                        <i class="fas fa-database"></i>
                        Client Onboarding
                    </h1>
                    <p class="header-subtitle">SQL Script Generator</p>
                </div>
                <div class="col-auto">
                    <button class="btn btn-outline-light btn-sm me-2" id="matrixBtn">
                        <i class="fas fa-table"></i> View Matrix
                    </button>
                    <button class="btn btn-outline-light btn-sm" id="resetBtn">
                        <i class="fas fa-redo"></i> Reset
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container my-5">
        <!-- Progress Steps -->
        <div class="progress-steps mb-5">
            <div class="progress-step active" data-step="1">
                <div class="step-number">1</div>
                <div class="step-label">Entity Details</div>
            </div>
            <div class="progress-step" data-step="2">
                <div class="step-number">2</div>
                <div class="step-label">Select Scopes</div>
            </div>
            <div class="progress-step" data-step="3">
                <div class="step-number">3</div>
                <div class="step-label">Configure Settings</div>
            </div>
            <div class="progress-step" data-step="4">
                <div class="step-number">4</div>
                <div class="step-label">Generate Script</div>
            </div>
        </div>

        <!-- Step Content -->
        <div class="step-content">
            <!-- Step 1: Entity Details -->
            <div class="step-panel active" id="step1">
                <div class="card shadow-lg">
                    <div class="card-body p-5">
                        <h2 class="step-title">
                            <i class="fas fa-building text-primary"></i>
                            Entity Details
                        </h2>
                        <p class="text-muted mb-4">Configure the primary client information and entity structure</p>

                        <div class="row g-4">
                            <!-- Parent Entity -->
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="parentName" class="form-label fw-bold">
                                        Parent Entity Name <span class="text-danger">*</span>
                                    </label>
                                    <input type="text" class="form-control form-control-lg" id="parentName"
                                           placeholder="e.g., Acme Corporation" required>
                                    <small class="form-text text-muted">The main client organization name</small>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="website" class="form-label fw-bold">Website</label>
                                    <input type="url" class="form-control form-control-lg" id="website"
                                           placeholder="https://www.example.com">
                                    <small class="form-text text-muted">Client's website URL</small>
                                </div>
                            </div>

                            <!-- Entity Types -->
                            <div class="col-12">
                                <hr class="my-4">
                                <h5 class="mb-3"><i class="fas fa-network-wired text-primary"></i> Entity Structure</h5>
                            </div>

                            <!-- Integrator -->
                            <div class="col-md-6">
                                <div class="entity-card">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="createIntegrator" checked>
                                        <label class="form-check-label fw-bold" for="createIntegrator">
                                            <i class="fas fa-plug text-success"></i> Create Integrator Entity
                                        </label>
                                    </div>
                                    <p class="entity-description">API integration entity with OAuth credentials</p>
                                    <div class="entity-details" id="integratorDetails">
                                        <div class="alert alert-info alert-sm">
                                            <i class="fas fa-info-circle"></i>
                                            Name will be auto-generated as "<strong><span id="integratorNamePreview">Parent Name</span> :Integrator</strong>"
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Device User -->
                            <div class="col-md-6">
                                <div class="entity-card">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="createDeviceUser">
                                        <label class="form-check-label fw-bold" for="createDeviceUser">
                                            <i class="fas fa-user-cog text-info"></i> Create Device User
                                        </label>
                                    </div>
                                    <p class="entity-description">User account for device/POS terminal access</p>
                                    <div class="entity-details d-none" id="deviceUserDetails">
                                        <div class="mb-3">
                                            <label for="deviceUsername" class="form-label">Username</label>
                                            <input type="text" class="form-control" id="deviceUsername" placeholder="device.user">
                                        </div>
                                        <div class="mb-3">
                                            <label for="devicePassword" class="form-label">Password</label>
                                            <input type="password" class="form-control" id="devicePassword" placeholder="••••••••">
                                        </div>
                                        <div class="mb-3">
                                            <label for="deviceEmail" class="form-label">Email</label>
                                            <input type="email" class="form-control" id="deviceEmail"
                                                   placeholder="user@example.com" value="development@bitventure.co.za">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="d-flex justify-content-end mt-5">
                            <button class="btn btn-primary btn-lg px-5" onclick="nextStep()">
                                Next <i class="fas fa-arrow-right ms-2"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Select Scopes -->
            <div class="step-panel" id="step2">
                <div class="card shadow-lg">
                    <div class="card-body p-5">
                        <h2 class="step-title">
                            <i class="fas fa-layer-group text-primary"></i>
                            Select Service Scopes
                        </h2>
                        <p class="text-muted mb-4">Choose which services and scopes to enable for this client</p>

                        <!-- Scope Selection Grid -->
                        <div class="scope-grid" id="scopeGrid">
                            <!-- Scopes will be populated here by JavaScript -->
                        </div>

                        <div class="d-flex justify-content-between mt-5">
                            <button class="btn btn-outline-secondary btn-lg px-5" onclick="previousStep()">
                                <i class="fas fa-arrow-left me-2"></i> Back
                            </button>
                            <button class="btn btn-primary btn-lg px-5" onclick="nextStep()">
                                Next <i class="fas fa-arrow-right ms-2"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scope Configuration Modal -->
            <div class="modal fade" id="scopeConfigModal" tabindex="-1">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">
                                <i class="fas fa-cog me-2"></i>
                                Configure Scope: <span id="modalScopeName"></span>
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <!-- Entity Assignment -->
                            <div class="mb-4">
                                <h6 class="fw-bold mb-3">
                                    <i class="fas fa-link text-primary"></i> Assign to Entities
                                </h6>
                                <div class="entity-checkboxes">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="modalLinkParent" checked disabled>
                                        <label class="form-check-label" for="modalLinkParent">
                                            <i class="fas fa-building text-primary"></i> Parent Entity
                                            <small class="text-muted d-block">Always linked</small>
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="modalLinkIntegrator">
                                        <label class="form-check-label" for="modalLinkIntegrator">
                                            <i class="fas fa-plug text-success"></i> Integrator Entity
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="modalLinkDeviceUser">
                                        <label class="form-check-label" for="modalLinkDeviceUser">
                                            <i class="fas fa-user-cog text-info"></i> Device User Entity
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <hr>

                            <!-- Rate Limiting -->
                            <div class="mb-4">
                                <h6 class="fw-bold mb-3">
                                    <i class="fas fa-tachometer-alt text-warning"></i> Rate Limiting
                                </h6>
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="modalRateLimit">
                                    <label class="form-check-label fw-bold" for="modalRateLimit">
                                        Enable Rate Limiting
                                    </label>
                                </div>
                                <div class="rate-limit-fields d-none" id="modalRateLimitFields">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label for="modalLimitCount" class="form-label">Limit Count</label>
                                            <input type="number" class="form-control" id="modalLimitCount"
                                                   placeholder="e.g., 1000" min="1">
                                            <small class="form-text text-muted">Maximum number of requests</small>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="modalLimitPeriod" class="form-label">Period</label>
                                            <select class="form-select" id="modalLimitPeriod">
                                                <option value="">No period</option>
                                                <option value="second">Per Second</option>
                                                <option value="minute">Per Minute</option>
                                                <option value="hour">Per Hour</option>
                                                <option value="day">Per Day</option>
                                                <option value="month">Per Month</option>
                                            </select>
                                            <small class="form-text text-muted">Time period for the limit</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary" id="saveScopeConfig">
                                <i class="fas fa-save me-2"></i> Save Configuration
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Compatibility Matrix Modal -->
            <div class="modal fade" id="matrixModal" tabindex="-1">
                <div class="modal-dialog modal-fullscreen">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">
                                <i class="fas fa-table me-2"></i>
                                Scope/Service/Setting Compatibility Matrix
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>
                                This matrix shows which scopes, services, and settings are available for each entity type.
                                <strong>✓</strong> indicates availability, <strong>✗</strong> indicates not available.
                            </div>
                            <div id="matrixContainer" class="table-responsive">
                                <!-- Matrix will be populated here by JavaScript -->
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 3: Configure Settings -->
            <div class="step-panel" id="step3">
                <div class="card shadow-lg">
                    <div class="card-body p-5">
                        <h2 class="step-title">
                            <i class="fas fa-sliders-h text-primary"></i>
                            Configure Settings
                        </h2>
                        <p class="text-muted mb-4">Configure settings for each selected scope</p>

                        <div id="settingsContainer">
                            <!-- Settings will be populated here by JavaScript -->
                            <div class="text-center text-muted py-5">
                                <i class="fas fa-info-circle fa-3x mb-3"></i>
                                <p>Select scopes in the previous step to configure their settings</p>
                            </div>
                        </div>

                        <div class="d-flex justify-content-between mt-5">
                            <button class="btn btn-outline-secondary btn-lg px-5" onclick="previousStep()">
                                <i class="fas fa-arrow-left me-2"></i> Back
                            </button>
                            <button class="btn btn-primary btn-lg px-5" onclick="nextStep()">
                                Next <i class="fas fa-arrow-right ms-2"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 4: Generate Script -->
            <div class="step-panel" id="step4">
                <div class="card shadow-lg">
                    <div class="card-body p-5">
                        <h2 class="step-title">
                            <i class="fas fa-code text-primary"></i>
                            Generate SQL Script
                        </h2>
                        <p class="text-muted mb-4">Review your configuration and generate the onboarding script</p>

                        <!-- Summary -->
                        <div class="summary-section mb-4">
                            <h5 class="fw-bold mb-3"><i class="fas fa-clipboard-check"></i> Configuration Summary</h5>
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <div class="summary-card">
                                        <div class="summary-label">Parent Entity</div>
                                        <div class="summary-value" id="summaryParentName">-</div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="summary-card">
                                        <div class="summary-label">Selected Scopes</div>
                                        <div class="summary-value" id="summaryScopeCount">0</div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="summary-card">
                                        <div class="summary-label">Entities</div>
                                        <div class="summary-value" id="summaryEntityCount">1</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Generate Button -->
                        <div class="text-center mb-4">
                            <button class="btn btn-success btn-lg px-5 py-3" id="generateBtn">
                                <i class="fas fa-magic me-2"></i>
                                Generate SQL Script
                            </button>
                        </div>

                        <!-- Output Section -->
                        <div class="output-section d-none" id="outputSection">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="fw-bold mb-0"><i class="fas fa-file-code"></i> Generated Script</h5>
                                <div>
                                    <button class="btn btn-outline-primary btn-sm me-2" id="copyBtn">
                                        <i class="fas fa-copy"></i> Copy
                                    </button>
                                    <button class="btn btn-outline-secondary btn-sm" id="downloadBtn">
                                        <i class="fas fa-download"></i> Download
                                    </button>
                                </div>
                            </div>
                            <div class="code-output-wrapper">
                                <pre><code id="sqlOutput" class="language-sql"></code></pre>
                            </div>
                        </div>

                        <div class="d-flex justify-content-between mt-5">
                            <button class="btn btn-outline-secondary btn-lg px-5" onclick="previousStep()">
                                <i class="fas fa-arrow-left me-2"></i> Back
                            </button>
                            <button class="btn btn-outline-primary btn-lg px-5" onclick="startOver()">
                                <i class="fas fa-redo me-2"></i> Start Over
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="app-footer">
        <div class="container text-center">
            <p class="mb-0">
                <i class="fas fa-shield-alt"></i>
                SQL Client Onboarding Generator &copy; 2025
            </p>
        </div>
    </footer>

    <!-- Loading Overlay -->
    <div class="loading-overlay d-none" id="loadingOverlay">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-3">Generating SQL Script...</p>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/scope_settings.js"></script>
    <script src="js/modern-app.js"></script>
</body>
</html>
